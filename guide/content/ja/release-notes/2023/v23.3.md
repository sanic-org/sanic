---
title: ãƒãƒ¼ã‚¸ãƒ§ãƒ³ 23.3
---

# ãƒãƒ¼ã‚¸ãƒ§ãƒ³ 23.3

.. TOC::

## ã¯ã˜ã‚ã«

This is the first release of the version 23 [release cycle](../../organization/policies.md#release-schedule). ã“ã®ã‚ˆã†ã«ã€ã„ãã¤ã‹ã®å»ƒæ­¢äºˆå®šãŒå«ã¾ã‚Œã¦ãŠã‚Šã€ã†ã¾ãã„ã‘ã°ã„ãã¤ã‹ã®_å°è¦æ¨¡ãª_ç ´å£Šçš„ãªå¤‰æ›´ãŒã‚ã‚Šã¾ã™ã€‚ ä½•ã‹å•é¡ŒãŒç™ºç”Ÿã—ãŸå ´åˆã¯ã€ [GitHub](https://github.com/sanic-org/sanic/issues/new/choose) ã«ã”æ³¨æ„ãã ã•ã„ã€‚

## çŸ¥ã£ã¦ãŠãã¹ãã“ã¨

è©³ç´°ã¯ [Changelog](https://sanic.readthedocs.io/en/stable/sanic/changelog.html) ã‚’ã”è¦§ãã ã•ã„ã€‚ æ³¨ç›®ã™ã¹ãæ–°æ©Ÿèƒ½ã‚„ç ´æã—ãŸæ©Ÿèƒ½ã€ãã—ã¦ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã™ã‚‹æ©Ÿèƒ½...

### ã‚ˆã‚Šå„ªã‚ŒãŸãƒˆãƒ¬ãƒ¼ã‚¹ãƒãƒƒã‚¯ã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ

SCOã¯2ã¤ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’GitHubä¸Šã®Sanicåå‰ç©ºé–“ã«æ¡ç”¨ã—ã¾ã—ãŸ: [tracerite](https://github.com/sanic-org/tracerite) ã¨ [html5tagger](https://github.com/sanic-org/html5tagger) ã“ã‚Œã‚‰ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯ã€ãƒ‡ãƒãƒƒã‚°ãƒ—ãƒ­ã‚»ã‚¹ã«å½¹ç«‹ã¤è©³ç´°ã‚’æä¾›ã—ã€ä¿¡ã˜ã‚‰ã‚Œãªã„ã»ã©ã®æ–°ã—ã„ã‚¨ãƒ©ãƒ¼ãƒšãƒ¼ã‚¸ã‚’æä¾›ã™ã‚‹ãŸã‚ã«ãƒãƒ¼ãƒ ã‚’ç·¨æˆã—ã¾ã™ã€‚

ã“ã‚Œã¯ã€DEBUGãƒ¢ãƒ¼ãƒ‰ã¾ãŸã¯PRODãƒ¢ãƒ¼ãƒ‰ã«ã‹ã‹ã‚ã‚‰ãšã€é–¢é€£ã™ã‚‹æƒ…å ±ã®ã¿ã‚’è¡¨ç¤ºã™ã‚‹ã‚ˆã†ã«èª¿æ•´ã•ã‚Œã¾ã™ã€‚

.. åˆ—::

```
**PRODãƒ¢ãƒ¼ãƒ‰ã‚’ä½¿ç”¨**
![image](/assets/images/error-html-no-debug.png)
```

.. åˆ—::

```
**DEBUGãƒ¢ãƒ¼ãƒ‰ã‚’ä½¿ã†**
![image](/assets/images/error-html-debug.png)
```

ãƒ©ã‚¤ãƒˆãƒ¢ãƒ¼ãƒ‰ã¨ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰ HTMLãƒšãƒ¼ã‚¸ã¯åˆ©ç”¨å¯èƒ½ã§ã€æš—é»™çš„ã«ä½¿ç”¨ã•ã‚Œã¾ã™ã€‚

### ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®åŸºæœ¬çš„ãªãƒ•ã‚¡ã‚¤ãƒ«ãƒ–ãƒ©ã‚¦ã‚¶ãƒ¼

é™çš„ãƒãƒ³ãƒ‰ãƒ©ã‹ã‚‰ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’æä¾›ã™ã‚‹å ´åˆã€Sanic ã¯ `directory_view=True` ã‚’ä½¿ç”¨ã—ã¦åŸºæœ¬çš„ãªãƒ•ã‚¡ã‚¤ãƒ«ãƒ–ãƒ©ã‚¦ã‚¶ãƒ¼ã‚’è¡¨ç¤ºã™ã‚‹ã‚ˆã†ã«è¨­å®šã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

.. åˆ—::

````
```python
app.static("/uploads/", "/path/to/dir/", directory_view=True)
```
````

.. åˆ—::

```
![image](/assets/images/directory-view.png)
```

ãƒ©ã‚¤ãƒˆãƒ¢ãƒ¼ãƒ‰ã¨ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰ HTMLãƒšãƒ¼ã‚¸ã¯åˆ©ç”¨å¯èƒ½ã§ã€æš—é»™çš„ã«ä½¿ç”¨ã•ã‚Œã¾ã™ã€‚

### Pythonã§HTMLãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ä½œæˆ

Sanic ã¯ [html5tagger](https://github) ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹ãŸã‚ã§ã™ã€‚ om/sanic-org/html5tagger) format@@0(#nicer-traceback-formatting) ã‚’ãƒœãƒ³ãƒãƒƒãƒˆã®ä¸‹ã«ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã—ã¾ã™ã€‚ Pythonã‚³ãƒ¼ãƒ‰ã§ç°¡å˜ã«HTMLãƒšãƒ¼ã‚¸ã‚’ç”Ÿæˆã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚

.. åˆ—::

````
```python
from html5tagger import Document
from sanic import Request, Sanic, html

app = Sanic("TestApp")

@app.get("/")
async def handler(request: Request):
    doc = Document("My Website")
    doc.h1("Hello, world.")
    with doc.table(id="data"):
        doc.tr.th("First").th("Second").th("Third")
        doc.tr.td(1).td(2).td(3)
    doc.p(class_="text")("A paragraph with ")
    doc.a(href="/files")("a link")(" and ").em("formatting")
    return html(doc)
```
````

.. åˆ—::

````
```html
<!DOCTYPE html>
<meta charset="utf-8">
<title>My Website</title>
<h1>Hello, world.</h1>
<table id=data>
    <tr>
        <th>First
        <th>Second
        <th>Third
    <tr>
        <td>1
        <td>2
        <td>3
</table>
<p class=text>
    A paragraph with <a href="/files">a link</a> and <em>formatting</em>
```
````

### è‡ªå‹•ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹æä¾›ã¯é™çš„ãƒãƒ³ãƒ‰ãƒ©ã§åˆ©ç”¨ã§ãã¾ã™

Sanicã¯ã€é™çš„ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’æä¾›ã™ã‚‹ã¨ãã«ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æä¾›ã™ã‚‹ã‚ˆã†ã«è¨­å®šã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚

```python
app.static("/assets/", "/path/to/some/dir", index="index.html")
```

ä¸Šè¨˜ã‚’ä½¿ç”¨ã™ã‚‹å ´åˆã€`http://example.com/assets/`ã¸ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã¯ã€ãã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ã‚ã‚‹`index.html`ãƒ•ã‚¡ã‚¤ãƒ«ã‚’è‡ªå‹•çš„ã«æä¾›ã—ã¾ã™ã€‚

### ã‚·ãƒ³ãƒ—ãƒ«ãª CLI ã‚¿ãƒ¼ã‚²ãƒƒãƒˆ

Sanicã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ã¯ã€å¤‰æ•°`app`ã‚’ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã¨ã—ã¦ä½¿ç”¨ã™ã‚‹ã®ãŒä¸€èˆ¬çš„ã§ã™ã€‚ ã“ã®ãŸã‚ã§ã™ CLI ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ã‚¿ãƒ¼ã‚²ãƒƒãƒˆ (`sanic` ã‚³ãƒãƒ³ãƒ‰ã® 2 ç•ªç›®ã®å€¤) ã¯ã€ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã«åŸºã¥ã„ã¦ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’æ¨å®šã—ã‚ˆã†ã¨ã—ã¾ã™ã€‚ ã‚¿ãƒ¼ã‚²ãƒƒãƒˆãŒ `app` å¤‰æ•°ã‚’å«ã‚€ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®å ´åˆã¯ã€ãã‚Œã‚’ä½¿ç”¨ã—ã¾ã™ã€‚

ç¾åœ¨ã€CLI ã‹ã‚‰ Sanic ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’èµ·å‹•ã™ã‚‹æ–¹æ³•ã¯ 4 ã¤ã‚ã‚Šã¾ã™ã€‚

#### 1. ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹

é€šå¸¸ã¨åŒæ§˜ã«ã€ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã¨ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã¸ã®ãƒ‘ã‚¹ã‚’æä¾›ã™ã‚‹ã“ã¨ã¯æœŸå¾…ã©ãŠã‚Šã«å‹•ä½œã—ã¾ã™ã€‚

```sh
sanic path.to.module:app # ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¢ãƒ—ãƒª ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹
```

#### 2. ç”³è«‹å·¥å ´

ä»¥å‰ã¯ã€ãƒ•ã‚¡ã‚¯ãƒˆãƒªãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’æä¾›ã™ã‚‹ã«ã¯ã€ `--factory` ãƒ•ãƒ©ã‚°ã‚’ä½¿ç”¨ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã—ãŸã€‚ ã“ã‚Œã¯ç¾åœ¨çœç•¥ã§ãã¾ã™ã€‚

```sh
sanic path.to.module:create_app # ãƒ•ã‚¡ã‚¯ãƒˆãƒªãƒ‘ã‚¿ãƒ¼ãƒ³
```

#### 3. Sanic Simple Server ã‚’èµ·å‹•ã™ã‚‹ãƒ‘ã‚¹

åŒæ§˜ã«ã€Sanic ã‚·ãƒ³ãƒ—ãƒ«ãªã‚µãƒ¼ãƒãƒ¼ (é™çš„ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’æä¾›ã™ã‚‹) ã‚’èµ·å‹•ã™ã‚‹ã«ã¯ã€ä»¥å‰ã¯ `--simple` ãƒ•ãƒ©ã‚°ã‚’ä½¿ç”¨ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã—ãŸã€‚ ã“ã‚Œã‚’çœç•¥ã™ã‚‹ã“ã¨ãŒã§ãã€ä»£ã‚ã‚Šã«ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¸ã®ãƒ‘ã‚¹ã‚’å˜ç´”ã«æä¾›ã—ã¾ã™ã€‚

```sh
sanic ./path/to/directory/ # simple serve
```

#### 4. å¤‰æ•°`app`ã‚’å«ã‚€Pythonãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«

å‰è¿°ã®ã‚ˆã†ã«ã€ã‚¿ãƒ¼ã‚²ãƒƒãƒˆãŒ `app` å¤‰æ•°ã‚’å«ã‚€ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®å ´åˆã€‚ ã“ã‚Œã‚’ä½¿ç”¨ã—ã¾ã™ (å¤‰æ•°`app`ãŒ`Sanic`ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã§ã‚ã‚‹ã¨ä»®å®šã—ã¾ã™)ã€‚

```sh
appã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’æŒã¤sanic path.to.module # ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«
```

### Cookieã®è¨­å®šã¨å‰Šé™¤ã®ãŸã‚ã®ã‚ˆã‚Šä¾¿åˆ©ãªæ–¹æ³•

å¤ã„ã‚¯ãƒƒã‚­ãƒ¼ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã¯ãã“ã¡ãªãã¦ä¸å™¨ç”¨ã§ã—ãŸã€‚ æ™®é€šã®Pythonã®ã‚ˆã†ã«ã¯è¦‹ãˆã¾ã›ã‚“ã§ã—ãŸã€‚ãªãœãªã‚‰ã€"é­”æ³•"ãŒã‚ªãƒ³ã«ãªã£ã¦ã„ã‚‹ã‹ã‚‰ã§ã™ã€‚

.. åˆ—::

```
ğŸ˜± ã“ã‚Œã¯ç›´æ„Ÿçš„ã§ã¯ãªãã€æ–°è¦å‚å…¥è€…ã«ã¨ã£ã¦æ··ä¹±ã—ã¦ã„ã¾ã™ã€‚
```

.. åˆ—::

````
```python
response = text("ã“ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã«ã¯ã‚¯ãƒƒã‚­ãƒ¼ãŒã‚ã‚Šã¾ã™")
response.cookies["test"] = "It worked!"
response. ookies["test"]["domain"] = ".yummy-yummy-cookie.com"
response.cookies["test"]["httponly"] = True
```
````

ã“ã®ãƒ—ãƒ­ã‚»ã‚¹ã‚’ã‚ˆã‚Šä¾¿åˆ©ã«ã™ã‚‹ãŸã‚ã«ã€æ–°ã—ã„ãƒ¡ã‚½ãƒƒãƒ‰(å®Œå…¨ã«`Cookie`ã¨`CookieJar`ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ)ãŒè¿½åŠ ã•ã‚Œã¾ã—ãŸã€‚

.. åˆ—::

```
:releaseed_face: ã‚ã‚...ã‚‚ã£ã¨ã„ã„ã€‚
```

.. åˆ—::

````
```python
response = text("There's a cookie up in this response")
response.add_cookie(
    "test",
    "It worked!",
    domain=".yummy-yummy-cookie.com",
    httponly=True
)
```
````

### ã‚ˆã‚Šè‰¯ã„ã‚¯ãƒƒã‚­ãƒ¼ã®äº’æ›æ€§

Sanic ã¯ [cookie prefixes](https://developer.mozilla.org/en-US/docs/Web/HTTP/Cookie#cookie_prefixes) ã®ã‚µãƒãƒ¼ãƒˆã‚’è¿½åŠ ã—ã¾ã—ãŸã€‚ã“ã‚Œã«ã‚ˆã‚Šã€å€¤ã‚’æŒã¤ Cookie ã‚’èª­ã¿æ›¸ãã—ã‚„ã™ããªã‚Šã¾ã—ãŸã€‚

Cookieã®è¨­å®šä¸­...

```py
response.cookies.add_cookie("foo", "bar", host_prefix=True)
```

`__Host-foo`ã¨ã„ã†ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹ä»˜ãã®ã‚¯ãƒƒã‚­ãƒ¼ãŒä½œæˆã•ã‚Œã¾ã™ã€‚ ãŸã ã—ã€ãƒªã‚¯ã‚¨ã‚¹ãƒˆã§ã‚¯ãƒƒã‚­ãƒ¼ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹å ´åˆã¯ã€ãƒ˜ãƒƒãƒ€ãƒ¼ã®å­˜åœ¨ã‚’çŸ¥ã‚‰ãªãã¦ã‚‚ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã™ã€‚

```py
request.cookies.get("foo")
```

ãªãŠã€ã‚¯ãƒƒã‚­ãƒ¼ã¯ [headers](#access-any-header-as-a-property) ã¨åŒæ§˜ã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã¨ã—ã¦ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ã€‚

```python
request.cookies.foo
```

ã‚¯ãƒƒã‚­ãƒ¼ã¯ `request.args` ã¨ `request.form` ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«ä¼¼ã¦ãŠã‚Šã€è¤‡æ•°ã®å€¤ã‚’å–å¾—ã™ã‚‹ã«ã¯ `getlist` ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚

```py
request.cookies.getlist("foo")
```

format@@0(https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Set-Cookie#partitioned_cookie)ã®ä½œæˆã‚‚ã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã¾ã™ã€‚

```py
response.cookies.add_cookie(..., partitioned=True)
```

### ğŸš¨ _BREAKING CHANGE_ - ã‚ˆã‚Šå¼·åŠ›ãª `SanicException`

Sanicã¯åŸºæœ¬ã‚¯ãƒ©ã‚¹ã®ä¾‹å¤–ã¨ã—ã¦`SanicException`ã‚’ã—ã°ã‚‰ãå«ã‚“ã§ã„ã¾ã™ã€‚ ã“ã‚Œã¯ `status_code` ãªã©ã‚’è¿½åŠ ã™ã‚‹ãŸã‚ã«æ‹¡å¼µã§ãã¾ã™ã€‚format@@0(http://localhost:8080/ja/guide/best-practics/exceptions.html)

**ä»Šã§ã™**ã€æ§˜ã€…ãªä¾‹å¤–ã‚’ã™ã¹ã¦ä½¿ã†ã®ãŒç°¡å˜ã«ãªã‚Šã¾ã—ãŸã€‚ ä¸€èˆ¬çš„ã«ä½¿ç”¨ã•ã‚Œã‚‹ä¾‹å¤–ã¯ã€ãƒ«ãƒ¼ãƒˆãƒ¬ãƒ™ãƒ«ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‹ã‚‰ç›´æ¥ã‚¤ãƒ³ãƒãƒ¼ãƒˆã§ãã¾ã™ã€‚

```python
from sanic import NotFound, Unauthorized, BadRequest, ServerError
```

ã•ã‚‰ã«ã€ã“ã‚Œã‚‰ã®å¼•æ•°ã¯ã™ã¹ã¦ä¾‹å¤–å‹ã”ã¨ã«ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰å¼•æ•°ã¨ã—ã¦ä½¿ç”¨ã§ãã¾ã™ã€‚

| å¼•æ•°        | ã‚¿ã‚¤ãƒ—    | èª¬æ˜                           |
| --------- | ------ | ---------------------------- |
| `quiet`   | `bool` | ãƒ­ã‚°ã‹ã‚‰ã®ãƒˆãƒ¬ãƒ¼ã‚¹ãƒãƒƒã‚¯ã‚’æŠ‘åˆ¶ã™ã‚‹            |
| `context` | `dict` | ã‚¨ãƒ©ãƒ¼ãƒšãƒ¼ã‚¸ã«è¡¨ç¤ºã•ã‚Œã‚‹è¿½åŠ æƒ…å ± _å¸¸æ™‚_        |
| `extra`   | `dict` | _DEBUG_ ãƒ¢ãƒ¼ãƒ‰ã§ã‚¨ãƒ©ãƒ¼ãƒšãƒ¼ã‚¸ã«è¡¨ç¤ºã•ã‚Œã‚‹è¿½åŠ æƒ…å ± |
| `headers` | `dict` | è¿”ä¿¡ã«é€ä¿¡ã•ã‚Œã‚‹è¿½åŠ ãƒ˜ãƒƒãƒ€ãƒ¼               |

ã“ã‚Œã‚‰ã®ã©ã‚Œã‚‚ãã‚Œè‡ªä½“ã®æ–°æ©Ÿèƒ½ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚ ã—ã‹ã—ã€ãã‚Œã‚‰ã®ä½¿ç”¨æ–¹æ³•ã«ã‚ˆã‚Šä¸€è²«æ€§ãŒé«˜ã„ãŸã‚ã€ã‚¨ãƒ©ãƒ¼å¿œç­”ã‚’ç›´æ¥åˆ¶å¾¡ã™ã‚‹å¼·åŠ›ãªæ–¹æ³•ãŒä½œæˆã•ã‚Œã¾ã™ã€‚

```py
raise ServerError(headers={"foo": "bar"})
```

ã“ã‚Œã®éƒ¨åˆ†ã¯ã€ä»¥å‰ã¯ä½ç½®å¼•æ•°ãŒã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã®ã¿ã§ã‚ã‚‹ã¨ã„ã†ã“ã¨ã§ã™ã€‚

format@@0(https://sanic.readthedocs.io/en/stable/sanic/api/exceptions.html#module-sanic.exceptions)ã«ã‚ã‚‹å„ã‚¨ãƒ©ãƒ¼ã®å®Ÿè£…ã‚’ç¢ºèªã™ã‚‹ã“ã¨ã‚’ãŠå‹§ã‚ã—ã¾ã™ã€‚

### ğŸš¨ _BREAKING å¤‰æ›´_ - `Request.accept` æ©Ÿèƒ½ã‚’ã‚ˆã‚Šãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã¨ä»•æ§˜æº–æ‹ ã«æ›´æ–°ã—ã¾ã™ã€‚

`Accessor ã« `Accept`ãƒ˜ãƒƒãƒ€ã‚’è§£æã™ã‚‹æ©Ÿèƒ½ãŒæ”¹å–„ã•ã‚Œã¾ã—ãŸã€‚ ã“ã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’ä½¿ç”¨ã—ã¦ã„ã¦ã€ãã®ç­‰ä¾¡æ€§æ“ä½œã«é ¼ã£ã¦ã„ãŸå ´åˆã€ã“ã‚Œã¯å¤‰æ›´ã•ã‚Œã¾ã—ãŸã€‚ ãŠãã‚‰ãã€`request.accept.match()\` ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä½¿ç”¨ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

### ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã¨ã—ã¦ä»»æ„ã®ãƒ˜ãƒƒãƒ€ãƒ¼ã«ã‚¢ã‚¯ã‚»ã‚¹

ãƒ˜ãƒƒãƒ€ãƒ¼ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’ç°¡å˜ã«ã™ã‚‹ãŸã‚ã«ã€ãƒ˜ãƒƒãƒ€ãƒ¼ã®æœªå‡¦ç†ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã«ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã¨ã—ã¦ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã™ã€‚ ãƒ˜ãƒƒãƒ€ãƒ¼ã®åå‰ã¯ã€ã™ã¹ã¦ã®å°æ–‡å­—ã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã®åå‰ã§ã€ãƒã‚¤ãƒ•ãƒ³(`-`)ã‚’ã‚¢ãƒ³ãƒ€ãƒ¼ã‚¹ã‚³ã‚¢(`_`)ã«åˆ‡ã‚Šæ›¿ãˆã¾ã™ã€‚

ä¾‹:

.. åˆ—::

````
```
GET /foo/bar HTTP/1.1
Host: localhost
User-Agent: curl/7.88.1
X-Request-ID: 123ABC
```
````

.. åˆ—::

````
```py
request.headers.host
request.headers.user_agent
request.headers.x_request_id
```
````

### ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ `DELETE` ãƒœãƒ‡ã‚£ã‚’æ¶ˆè²»ã™ã‚‹

ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯ã€ `DELETE` ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®æœ¬æ–‡ãŒä½¿ç”¨ã•ã‚Œã€ `Request` ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«èª­ã¿è¾¼ã¾ã‚Œã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚ `POST`ã€`PUT`ã€`PATCH`ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ã‚ˆã†ã«ã€ `body`ã‚’åˆ©ç”¨ã§ãã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚

### `SSLContext`ã‚’ä½œæˆã™ã‚‹ã“ã¨ã‚’ç›´æ¥åˆ¶å¾¡ã™ã‚‹ãŸã‚ã®ã‚«ã‚¹ã‚¿ãƒ `CertLoader`

ç‹¬è‡ªã® `SSLContext` ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã—ãŸã„å ´åˆã‚‚ã‚ã‚Šã¾ã™ã€‚ ã“ã‚Œã‚’è¡Œã†ã«ã¯ã€ç›®çš„ã®ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ç”Ÿæˆã™ã‚‹ `CertLoader` ã®ã‚µãƒ–ã‚¯ãƒ©ã‚¹ã‚’ä½œæˆã§ãã¾ã™ã€‚

```python
from sanic.worker.loader import CertLoader

class MyCertLoader(CertLoader):
    def load(self, app: Sanic) -> SSLContext:
        ...

app = Sanic(..., certloader_class=MyCertLoader)
```

### éæ¨å¥¨ã¨å‰Šé™¤

1. _DEPRECATED_ - Dict-style cookieã®è¨­å®š
2. _DEPRECATED_ - JSON ã‚¨ãƒ©ãƒ¼ãƒ•ã‚©ãƒ¼ãƒãƒƒã‚¿ã‚’ä½¿ç”¨ã™ã‚‹å ´åˆã€1ã¤ã®è¦å› ã«å¯¾ã™ã‚‹ãƒªã‚¯ã‚¨ã‚¹ãƒˆã« JSON ãƒ‡ãƒ¼ã‚¿ã®å­˜åœ¨ã‚’ä½¿ç”¨ã™ã‚‹
3. _å‰Šé™¤_ - éæ¨å¥¨ã®`__blueprintname__` ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£
4. _å‰Šé™¤_ - ãƒ«ãƒ¼ãƒˆåã®é‡è¤‡
5. _å‰Šé™¤_ - é‡è¤‡ã—ãŸä¾‹å¤–ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ã®å®šç¾©
6. _å‰Šé™¤_ - æ——ä»˜ãã‚¤ãƒ³ã‚¹ãƒšã‚¯ã‚¿CLI
7. _å‰Šé™¤_ - ãƒ¬ã‚¬ã‚·ãƒ¼ã‚µãƒ¼ãƒãƒ¼ (`sanic.server.serve_single` ã¨ `sanic.server.serve_multiple` ã‚’å«ã‚€)
8. _REMOVED_ - ãƒã‚¤ãƒˆæ–‡å­—åˆ—ä»˜ãã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’æä¾›ã—ã¾ã™
9. _å‰Šé™¤_ - `Request.request_middleware_started`
10. _å‰Šé™¤_ - `Websocket.connection`

#### ãƒ«ãƒ¼ãƒˆåãŒé‡è¤‡ã—ã¦ã„ã‚‹å ´åˆã¯ã‚‚ã†è¨±å¯ã•ã‚Œã¦ã„ã¾ã›ã‚“

ãƒãƒ¼ã‚¸ãƒ§ãƒ³22.9ã§ã¯ã€Sanicã¯v23.3ãŒãƒ«ãƒ¼ãƒˆã‚’é‡è¤‡ã—ãŸåå‰ã§ç™»éŒ²ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ã“ã¨ã‚’ç™ºè¡¨ã—ã¾ã—ãŸã€‚ æ¬¡ã®ã‚¨ãƒ©ãƒ¼ãŒè¡¨ç¤ºã•ã‚ŒãŸå ´åˆã¯ã€ãã®å¤‰æ›´ã«ã‚ˆã‚‹ã‚‚ã®ã§ã™ã€‚

> sanic.exceptions.ServerError: ãƒ«ãƒ¼ãƒˆåãŒé‡è¤‡ã—ã¦ã„ã¾ã™: SomeApp.some_handlerã€‚ `name` ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã§ã€åå‰ã‚’å¤‰æ›´ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ ã‚¯ãƒ©ã‚¹ã¨é–¢æ•°åã‹ã‚‰æ´¾ç”Ÿã—ãŸæš—é»™çš„ãªåå‰ã‚’å¤‰æ›´ã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ã€‚ è©³ç´°ã¯ https://sanic.dev/ja/guide/release-notes/v23.3.html#duplicated-route-names-are-no-longer-allowed ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

ã“ã‚Œã‚’è¦‹ã¦ã„ã‚‹å ´åˆã¯ã€ãƒ«ãƒ¼ãƒˆã«æ˜ç¤ºçš„ãªåå‰ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã‚’ã‚ªãƒ—ãƒˆã‚¤ãƒ³ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

.. åˆ—::

````
**BAD**
```python
app = Sanic("SomeApp")

@app.get("/")
@app.get("/foo")
async def handler(request: Request):
```
````

.. åˆ—::

````
**GOOD**
```python
app = Sanic("SomeApp")

@app.get("/", name="root")
@app.get("/foo", name="foo")
async def handler(request: Request):
```
````

#### ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚¯ãƒƒã‚­ãƒ¼

ãƒ¬ã‚¹ãƒãƒ³ã‚¹Cookieã¯äº’æ›æ€§ã®ç›®çš„ã§ã®ã¿ã€Œdictã€ã¨ã—ã¦æ©Ÿèƒ½ã—ã¾ã™ã€‚ ãƒãƒ¼ã‚¸ãƒ§ãƒ³ 24.3 ã§ã¯ã€ã™ã¹ã¦ã® `dict` ãƒ¡ã‚½ãƒƒãƒ‰ã¯å‰Šé™¤ã•ã‚Œã€ãƒ¬ã‚¹ãƒãƒ³ã‚¯ãƒƒã‚­ãƒ¼ã¯ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ã¿ã«ãªã‚Šã¾ã™ã€‚

ã—ãŸãŒã£ã¦ã€ã‚¯ãƒƒã‚­ãƒ¼ã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’è¨­å®šã™ã‚‹ãŸã‚ã«ã“ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹å ´åˆã¯ã€ãƒãƒ¼ã‚¸ãƒ§ãƒ³24.3ä»¥å‰ã«ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

```python
resp = HTTPResponse()
resp.cookies["foo"] = "bar"
resp.cookies["foo"]["httponly"] = True
```

ä»£ã‚ã‚Šã«ã€`add_cookie`ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä½¿ç”¨ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

```python
resp = HTTPResponse()
resp.add_cookie("foo", "bar", httponly=True)
```

#### Cookie ã‚’ãƒªã‚¯ã‚¨ã‚¹ãƒˆ

Sanicã¯ã€RFC ä»•æ§˜ã«æº–æ‹ ã™ã‚‹ãŸã‚ã«é‡è¤‡ã—ãŸ Cookie ã‚­ãƒ¼ã‚’èª­ã¿å–ã‚‹ã‚µãƒãƒ¼ãƒˆã‚’è¿½åŠ ã—ã¾ã—ãŸã€‚ å¾Œæ–¹äº’æ›æ€§ã‚’ç¶­æŒã™ã‚‹ãŸã‚ã«ã€`__getitem__`ã‚’ä½¿ç”¨ã—ã¦ã‚¯ãƒƒã‚­ãƒ¼ã®å€¤ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã¨ã€é€ä¿¡ã•ã‚ŒãŸæœ€åˆã®å€¤ã‚’å–å¾—ã™ã‚‹ãŸã‚ã«å‹•ä½œã—ã¾ã™ã€‚ ã—ãŸãŒã£ã¦ã€ãƒãƒ¼ã‚¸ãƒ§ãƒ³23.3ä»¥å‰ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã§ã¯ã€ã“ã‚Œã¯ `True` ã«ãªã‚Šã¾ã™ã€‚

```python
assert request.cookies["foo"] == "bar"
assert request.cookies.get("foo") == "bar"
```

ãƒãƒ¼ã‚¸ãƒ§ãƒ³ 23.3 ãŒ `getlist` ã‚’è¿½åŠ ã—ã¾ã—ãŸ

```python
assert request.cookies.getlist("foo") == ["bar"]
```

ä¸Šè¨˜ã®ã‚ˆã†ã«ã€ä»–ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ—ãƒ­ãƒ‘ãƒ†ã‚£(`request.args`ã€`request.form`ãªã©)ã«ã‚ã‚‹ã‚ˆã†ã«ã€`get`ã¨`getlist`ãƒ¡ã‚½ãƒƒãƒ‰ãŒåˆ©ç”¨ã§ãã¾ã™ã€‚ v24.3 ä»¥é™ã€ã‚¯ãƒƒã‚­ãƒ¼ã® `__getitem__` ãƒ¡ã‚½ãƒƒãƒ‰ã¯ã“ã‚Œã‚‰ã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã¨ã¾ã£ãŸãåŒã˜ã‚ˆã†ã«å‹•ä½œã—ã¾ã™ã€‚ ã“ã‚Œã¯ã€`__getitem__`ãŒå€¤ã®ãƒªã‚¹ãƒˆã‚’è¿”ã™ã“ã¨ã‚’æ„å‘³ã—ã¾ã™ã€‚

ã—ãŸãŒã£ã¦ã€ã“ã®æ©Ÿèƒ½ã‚’ä½¿ç”¨ã—ã¦1ã¤ã®å€¤ã ã‘ã‚’è¿”ã™å ´åˆã¯ã€v24.3ã®å‰ã«ä»¥ä¸‹ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã«ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã—ã¦ãã ã•ã„ã€‚

```python
assert request.cookies["foo"] == ["bar"]
assert request.cookies.get("foo") == "bar"
assert request.cookies.getlist("foo") == ["bar"]
```

## ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™

ã“ã®ãƒªãƒªãƒ¼ã‚¹ã«å‚åŠ ã„ãŸã ãã€ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ï¼š :clap:

[@ahopkins](https://github.com/ahopkins)
[@ChihweiLHBird](https://github.com/ChihweiLHBird)
[@deounix](https://github.com/deounix)
[@Kludex](https://github.com/Kludex)
[@mbendiksen](https://github.com/mbendiksen)
[@prryplatypus](https://github.com/prryplatypus)
[@r0x0d](https://github.com/r0x0d)
[@SaidBySolo](https://github.com/SaidBySolo)
[@sjsadowski](https://github.com/sjsadowski)
[@stricaud](https://github.com/stricaud)
[@Tracyca209](https://github.com/Tracyca209)
[@Tronic](https://github.com/Tronic)

---

ã‚ãªãŸãŒãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’æ¥½ã—ã‚“ã§ã„ã‚‹ãªã‚‰ã€è²¢çŒ®ã‚’æ¤œè¨ã—ã¦ãã ã•ã„ã€‚ ã‚‚ã¡ã‚ã‚“ç§ãŸã¡ã¯ã‚³ãƒ¼ãƒ‰è²¢çŒ®ã¯å¤§å¥½ãã§ã™ãŒã€ã©ã‚“ãªå½¢ã§ã‚‚è²¢çŒ®ã§ãã¾ã™ã€‚ ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’æ›¸ã„ãŸã‚Šã€ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã‚’ç¤ºã—ãŸã‚Šã€ä¼šè©±ã«å‚åŠ ã—ãŸã‚Šã€å£°ã‚’çŸ¥ã‚‰ã›ãŸã‚Šã™ã‚‹ã“ã¨ã‚’æ¤œè¨ã—ã¦ãã ã•ã„ã€‚format@@0(https://opencollective.com/sanic-org/)
