---
title: 22.6 ç‰ˆæœ¬
---

# 22.6 ç‰ˆæœ¬

.. toc::

## ä¸€. å¯¼è¨€

è¿™æ˜¯ç¬¬äºŒæ¬¡ç‰ˆæœ¬çš„ 22 [å‘è¡Œå‘¨æœŸ] (../../org/policies.md#release-schedule)ã€‚ ç‰ˆæœ¬22å°†åœ¨12æœˆä»½çš„é•¿æœŸæ”¯æŒç‰ˆæœ¬å‘å¸ƒæ—¶â€œæœ€åå®Œæˆâ€ã€‚

## äº†è§£ä»€ä¹ˆ

æ›´å¤šè¯¦ç»†ä¿¡æ¯åœ¨ [Changelog](https://sanic.readthedocs.io/en/stable/sanic/changelog.html)ã€‚ æ˜¾è‘—çš„æ–°åŠŸèƒ½æˆ–ç ´æŸåŠŸèƒ½ä»¥åŠå‡çº§å†…å®¹...

### `DEBUG`æ¨¡å¼ä¸‹è‡ªåŠ¨è®¾ç½®TLS

Sanic æœåŠ¡å™¨å¯ä»¥ä½¿ç”¨ [mkcert](https://github.com/FiloSottile/mkcert) æˆ– [trustme](https://github.com/python-trio/trustme) è‡ªåŠ¨è®¾ç½®ä¸€ä¸ª TLS è¯ä¹¦ã€‚ æ­¤è¯ä¹¦å°†å¯ç”¨æœ¬åœ°å¼€å‘ç¯å¢ƒçš„`https://localhost`(æˆ–å¦ä¸€ä¸ªæœ¬åœ°åœ°å€)ã€‚ æ‚¨å¿…é¡»è‡ªå·±å®‰è£… `mkcert` æˆ– `trustme` æ‰èƒ½æ­£å¸¸å·¥ä½œã€‚

.. åˆ—:

````
```
$ sanic path.to.server:app --auto-tls --debug
```
````

.. åˆ—:

````
```python
app.run(debug=True, auto_tls=True)

````

åœ¨`ASGI`æ¨¡å¼æˆ–`PRODUCTION`æ¨¡å¼ä¸‹è¿è¡Œæ—¶ï¼Œæ­¤åŠŸèƒ½ä¸å¯ç”¨ã€‚ å½“åœ¨ç”Ÿäº§ä¸­è¿è¡Œ Sanicæ—¶ï¼Œæ‚¨åº”è¯¥ä½¿ç”¨çœŸæ­£çš„TLS è¯ä¹¦ï¼Œè¦ä¹ˆé€šè¿‡åˆæ³•çš„ä¾›åº”å•†è´­ä¹°ï¼Œè¦ä¹ˆä½¿ç”¨[æˆ‘ä»¬çš„åŠ å¯†](https://letsenccrypt.org/)ã€‚

### HTTP/3 Server :roç«ç®­ï¼š

2022å¹´6æœˆï¼Œå›½é™…ç”µå­äº¤æ˜“æ—¥å¿—æœ€åç¡®å®šå¹¶å‡ºç‰ˆäº†HTTP/3è§„æ ¼[RFC 9114](https://www.rfc-editor.org/rfc/rfc9114.html)ã€‚ ç®€è€Œè¨€ä¹‹ï¼ŒHTTP/3 æ˜¯ä¸€ä¸ª**æ‰€æœ‰**ä¸åŒäºHTTP/1.1å’ŒHTTP-2çš„åè®®ï¼Œå› ä¸ºå®ƒä½¿ç”¨ UDPè€Œä¸æ˜¯TCP æ–°çš„ HTTP åè®®ä¿è¯æ›´å¿«çš„ç½‘é¡µåŠ è½½æ—¶é—´å’Œè§£å†³æ—§æ ‡å‡†çš„ä¸€äº›é—®é¢˜ã€‚ ä½ è¢«é¼“åŠ±[é˜…è¯»æ›´å¤šå…³äº](https://http3-explanined.haxx.se/)è¿™ä¸ªæ–°çš„ç½‘é¡µæŠ€æœ¯ã€‚ æ‚¨å¯èƒ½éœ€è¦å®‰è£…ä¸€ä¸ª[èƒ½å¤Ÿçš„å®¢æˆ·ç«¯](https://curl.se/docs/http3.html)ï¼Œå› ä¸ºä¼ ç»Ÿçš„å·¥å…·å°†æ— æ³•å·¥ä½œã€‚

Sanic æœåŠ¡å™¨ä½¿ç”¨ [aioquic](https://github.com/aiortc/aioquic) æä¾› HTTP/3 æ”¯æŒã€‚ æ­¤ \*\*must \*\* å·²å®‰è£…ï¼š

```
pip install sanic aioquic
```

```
pip install sanic[http3]
```

è¦å¯åŠ¨ HTTP/3ï¼Œæ‚¨å¿…é¡»åœ¨è¿è¡Œåº”ç”¨ç¨‹åºæ—¶æ˜ç¡®è¯·æ±‚å®ƒã€‚

.. åˆ—:

````
``
$ sanic path.to.server:app --http=3
```

```
$ sanic path.to.server:app -3
```
````

.. åˆ—:

````
```python
app.run(version=3)
```
````

è¦åŒæ—¶è¿è¡Œä¸€ä¸ª HTTP/3 å’Œ HTTP/1.1 æœåŠ¡å™¨ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ v22.3 å¼•å…¥çš„ [application multiserve](./v22.3.html#application-multi-servve)ã€‚

.. åˆ—:

````
``
$ sanic path.to.server:app --http=3 --http=1
```

```
$ sanic path.to.server:app -3 -1
```
````

.. åˆ—:

````
```python
app.prepre(version=3)
app.pres(version=1)
Sanic.serve()
```
````

å› ä¸ºHTTP 3 éœ€è¦ TLSï¼Œæ‚¨ä¸èƒ½åœ¨æ²¡æœ‰TLS è¯ä¹¦çš„æƒ…å†µä¸‹å¯åŠ¨ HTTP/3 æœåŠ¡å™¨ã€‚ ä½ åº”è¯¥[è‡ªå·±è®¾ç½®å®ƒ](../how-to/tls.html)ï¼Œæˆ–è€…åœ¨ `DEBUG` æ¨¡å¼ä¸‹ä½¿ç”¨ `mkcert` ã€‚ ç›®å‰ï¼ŒHTTP/3 çš„è‡ªåŠ¨TLSè®¾ç½®ä¸ `trustme` ä¸å…¼å®¹ã€‚

\*\*ğŸ‘¶ æ­¤åŠŸèƒ½æ­£åœ¨å‘å¸ƒä¸º _EARLY RELEASE FEATURE_. \* å®ƒæ˜¯ **æ²¡æœ‰** å®Œå…¨ç¬¦åˆHTTP/3 è§„æ ¼ï¼Œç¼ºå°‘ä¸€äº›åŠŸèƒ½ï¼Œå¦‚ [websockets](https://websockets)ã€‚ pet.whatwg.org/, [webtransport](https://w3c.github.io/webtransport/), å’Œ [æ¨é€å›å¤](https://http3-explanined.haxx.se/en/h3/h3-pub). ç›¸åï¼Œæ­¤ç‰ˆæœ¬çš„æ„å›¾æ˜¯ä½¿ç°æœ‰çš„ HTTP è¯·æ±‚/å“åº”å‘¨æœŸä¸HTTP/3å®ç°åœ°ç‰©å¯¹ç­‰ã€‚ åœ¨ä»¥åçš„å‡ ä¸ªç‰ˆæœ¬ä¸­ï¼Œå°†ä¼šæ·»åŠ æ›´å¤šçš„ HTTP/3 åŠŸèƒ½ï¼Œå¹¶ä¸”å®ƒçš„ API å·²ç»å®Œæˆã€‚

### å‰åä¸€è‡´çš„å¼‚å¸¸åç§°

æœ‰äº›Sanicå¼‚å¸¸å·²æ›´åä¸ºæ›´ç¬¦åˆæ ‡å‡†HTTPå“åº”åç§°ã€‚

- `InvalidUsage` >> `BadRequest`
- `MethodNotSupped` >> `MethodNotalled`
- `ContentRangeError` >> `RangeNotSatisfiable`

æ‰€æœ‰æ—§åå­—éƒ½å·²è¢«åˆ«åï¼Œå¹¶å°†ä¿æŒå‘åå…¼å®¹ã€‚

### å½“å‰è¯·æ±‚è·å–

ç±»ä¼¼äºè®¿é—®åº”ç”¨ç¨‹åºçš„ API (`Sanic.get_app()`)ï¼Œåœ¨è¯·æ±‚å¤„ç†ç¨‹åºä¹‹å¤–æœ‰ä¸€ä¸ªæ–°æ–¹æ³•æ¥æ£€ç´¢å½“å‰è¯·æ±‚ã€‚

```python
ä» sanic å¯¼å…¥è¯·æ±‚

Request.get_current()
```

### æ”¹è¿›äº† API æ”¯æŒè®¾ç½®ç¼“å­˜æ§åˆ¶å¤´éƒ¨

`file`å“åº”åŠ©æ‰‹æœ‰ä¸€äº›é¢å¤–çš„å‚æ•°ï¼Œä½¿å®ƒæ›´å®¹æ˜“å¤„ç†è®¾ç½® [Cache-Control](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Cache-Control) headerã€‚

```python
æ–‡ä»¶(
    ...,
    last_modified=...,
    max_age=....,
    no_store=....,
)
```

### è‡ªå®šä¹‰ `loads` å‡½æ•°

å°±åƒSanicæ”¯æŒå…¨å±€è®¾ç½®ä¸€ä¸ªè‡ªå®šä¹‰ `dumps`ï¼Œæ‚¨ç°åœ¨å¯ä»¥è®¾ç½®ä¸€ä¸ªå…¨å±€è‡ªå®šä¹‰ \`loads'ã€‚

```python
ä» orjson å¯¼å…¥è´Ÿè½½

åº”ç”¨ = Sanic("æµ‹è¯•", loads=loads)
```

### åºŸå¼ƒå’Œç§»é™¤

1. _REMOVED_â€”â€”ç”³è¯·è€…ä¸å¾—å†é€‰æ‹©é€€å‡ºç”³è¯·ç™»è®°å†Œ
2. _REMOVED_ - è‡ªå®šä¹‰å¼‚å¸¸å¤„ç†ç¨‹åºåœ¨å‘é€éƒ¨åˆ†å¼‚å¸¸åå°†ä¸å†è¿è¡Œ
3. _REMOVED_ - Fallback é”™è¯¯æ ¼å¼ä¸èƒ½è®¾ç½®åœ¨ `ErrorHandler` ä¸Šï¼Œå¹¶ä¸”å¿…é¡»**ä»…** åœ¨ `Config` ä¸­è®¾ç½®
4. _REMOVED_ - ä¸å†å…è®¸ä¸ºå¯åŠ¨è®¾ç½®è‡ªå®šä¹‰ `LOGO`
5. _REMOVED_ - æ—§çš„ `stream` å“åº”æ–¹ä¾¿æ–¹æ³•å·²è¢«åˆ é™¤
6. _REMOVED_ - `AsyncServer.init` å·²è¢«åˆ é™¤ï¼Œä¸å†æ˜¯ `AsyncServer.app.state.is_started` çš„åˆ«å

## è°¢è°¢ä½ 

Thank you to everyone that participated in this release: :clap:

[@ahopkins](https://github.com/ahopkins)
[@amitay87](https://github.com/amitay87)
[@ashleysommer](https://github.com/ashleysommer)
[@azimovMichael](https://github.com/azimovMichael)
[@ChihweiLHBird](https://github.com/ChihweiLHBird)
[@kijk2869](https://github.com/kijk2869)
[@prryplatypus](https://github.com/prryplatypus)
[@SaidBySolo](https://github.com/SaidBySolo)
[@sjsadowski](https://github.com/sjsadowski)
[@timmo001](https://github.com/timmo001)
[@zozzz](https://github.com/zozzz)

---

å¦‚æœæ‚¨å–œæ¬¢è¿™ä¸ªé¡¹ç›®ï¼Œè¯·è€ƒè™‘ææ¬¾ã€‚ å½“ç„¶ï¼Œæˆ‘ä»¬å–œæ¬¢ä»£ç è´¡çŒ®ï¼Œä½†æˆ‘ä»¬ä¹Ÿå–œæ¬¢ä»»ä½•å½¢å¼çš„è´¡çŒ®ã€‚ è€ƒè™‘æ’°å†™ä¸€äº›æ–‡æ¡£ï¼Œæ˜¾ç¤ºå…³é—­çš„æƒ…å†µï¼ŒåŠ å…¥å¯¹è¯å¹¶è®©æ‚¨çš„å£°éŸ³ä¸ºäººæ‰€çŸ¥ï¼Œå¦‚æœæ‚¨èƒ½å¤Ÿï¼š[é‡‘èè´¡çŒ®](https://opencollective.com/sanic-org/)ã€‚
